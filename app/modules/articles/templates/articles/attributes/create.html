{% extends 'base.html' %}

{% block title %}Создание атрибута артикула | ERP VITTAVENTO{% endblock %}

{% block content %}
<div class="container">
    <h1 class="my-4">Создание атрибута артикула</h1>

    <div class="card shadow-sm">
        <div class="card-body">
            <form method="POST" action="{{ url_for('articles.attribute_create') }}">
                {{ form.csrf_token }}

                <div class="row mb-3">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="name" class="form-label">Наименование *</label>
                            {{ form.name(class="form-control" + (" is-invalid" if form.name.errors else "")) }}
                            {% if form.name.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.name.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="field_type" class="form-label">Тип поля *</label>
                            {{ form.field_type(class="form-select" + (" is-invalid" if form.field_type.errors else "")) }}
                            {% if form.field_type.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.field_type.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="category_id" class="form-label">Категория</label>
                            {{ form.category_id(class="form-select" + (" is-invalid" if form.category_id.errors else "")) }}
                            {% if form.category_id.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.category_id.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                            <small class="text-muted">Оставьте "Все категории", если атрибут применим ко всем категориям артикулов</small>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="default_value" class="form-label">Значение по умолчанию</label>
                            {{ form.default_value(class="form-control" + (" is-invalid" if form.default_value.errors else "")) }}
                            {% if form.default_value.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.default_value.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>

                        <div class="form-check mb-3">
                            {{ form.required(class="form-check-input") }}
                            <label class="form-check-label" for="required">
                                Обязательное поле
                            </label>
                        </div>
                    </div>
                </div>

                <div class="mb-3" id="enumValuesContainer" style="display: none;">
                    <label for="enum_values" class="form-label">Значения перечисления</label>
                    {{ form.enum_values(class="form-control" + (" is-invalid" if form.enum_values.errors else ""), rows=4) }}
                    {% if form.enum_values.errors %}
                        <div class="invalid-feedback">
                            {% for error in form.enum_values.errors %}
                                {{ error }}
                            {% endfor %}
                        </div>
                    {% endif %}
                    <small class="text-muted">Введите значения перечисления, по одному в строке</small>
                </div>

                <div class="mt-4">
                    <a href="{{ url_for('articles.attribute_index') }}" class="btn btn-secondary">
                        <i class="fas fa-times"></i> Отмена
                    </a>
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-save"></i> Сохранить
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const fieldTypeSelect = document.getElementById('field_type');
        const enumValuesContainer = document.getElementById('enumValuesContainer');

        // Функция для показа/скрытия блока со значениями перечисления
        function toggleEnumValues() {
            if (fieldTypeSelect.value === 'enum') {
                enumValuesContainer.style.display = 'block';
            } else {
                enumValuesContainer.style.display = 'none';
            }
        }

        // Инициализация
        toggleEnumValues();

        // Обработчик изменения типа поля
        fieldTypeSelect.addEventListener('change', toggleEnumValues);
    });
</script>
{% endblock %}

{% endblock %}